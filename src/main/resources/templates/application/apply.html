<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>양육 신청하기</title>
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
        }

        .div_abcde {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group-inline {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }

        .form-group-inline label {
            flex: 0 0 100px;
        }

        input, select, textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        button {
            padding: 10px 15px;
            background-color: #007BFF;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .family-member {
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
<div id="div_id" class="div_abcde">
    새가족 등록하기
</div>

<div class="form-group-inline">
    <label for="create_apply_id">순번</label>
    <input type="number" id="create_apply_id" required/>

    <label for="create_apply_name">이름</label>
    <input type="text" id="create_apply_name" required/>
</div>

<div class="form-group">
    <label for="create_apply_gender">성별</label>
    <select id="create_apply_gender" required>
        <option value="MALE">남성</option>
        <option value="FEMALE">여성</option>
        <option value="OTHER">기타</option>
    </select>
</div>

<div class="form-group">
    <label for="create_apply_email">이메일</label>
    <input type="email" id="create_apply_email" required/>
</div>

<div class="form-group">
    <label for="create_apply_phone">전화번호</label>
    <input type="tel" id="create_apply_phone" required/>
</div>

<div class="form-group">
    <label for="create_apply_address">주소</label>
    <input type="text" id="create_apply_address" required/>
</div>

<div class="form-group">
    <label for="create_apply_baptismType">유아/성인 세례</label>
    <select id="create_apply_baptismType" required>
        <option value="INFANT">유아 세례</option>
        <option value="ADULT">성인 세례</option>
    </select>
</div>

<div class="form-group">
    <label for="create_apply_marriageType">결혼 여부</label>
    <select id="create_apply_marriageType" required>
        <option value="YES">결혼함</option>
        <option value="NO">결혼하지 않음</option>
    </select>
</div>

<div id="family_members">
    <h3>가족 정보 (최대 6명)</h3>
    <div class="family-member">
        <label for="family_member_name_1">이름</label>
        <input type="text" id="family_member_name_1" required/>
        <label for="family_member_relationship_1">관계</label>
        <select id="family_member_relationship_1" required>
            <option value="PARENT">부모</option>
            <option value="SIBLING">형제/자매</option>
            <option value="CHILD">자녀</option>
            <option value="SPOUSE">배우자</option>
            <option value="GRANDPARENT">조부모</option>
            <option value="OTHER">기타</option>
        </select>
    </div>
</div>

<button id="add_family_member">가족 추가</button>

<div class="form-group">
    <label for="create_apply_content">특이사항</label>
    <textarea id="create_apply_content" class="large-input" placeholder="특이사항"></textarea>
</div>

<button onclick="create_apply()">저장</button>

<script>
    let familyMemberCount = 1;

    $('#add_family_member').click(function() {
        if (familyMemberCount < 6) {
            familyMemberCount++;
            $('#family_members').append(`
                <div class="family-member">
                    <label for="family_member_name_${familyMemberCount}">이름</label>
                    <input type="text" id="family_member_name_${familyMemberCount}" required/>
                    <label for="family_member_relationship_${familyMemberCount}">관계</label>
                    <select id="family_member_relationship_${familyMemberCount}" required>
                        <option value="PARENT">부모</option>
                        <option value="SIBLING">형제/자매</option>
                        <option value="CHILD">자녀</option>
                        <option value="SPOUSE">배우자</option>
                        <option value="GRANDPARENT">조부모</option>
                        <option value="OTHER">기타</option>
                    </select>
                </div>
            `);
        } else {
            alert("가족 구성원은 최대 6명까지 추가할 수 있습니다.");
        }
    });

    function create_apply() {
        const familyMembers = [];
        for (let i = 1; i <= familyMemberCount; i++) {
            familyMembers.push({
                name: $(`#family_member_name_${i}`).val(),
                relationship: $(`#family_member_relationship_${i}`).val()
            });
        }

        $.ajax({
            url: "/api/application/create",
            type: "POST",
            contentType: 'application/json; charset=utf-8',
            data: JSON.stringify({
                id: $("#create_apply_id").val(),
                name: $("#create_apply_name").val(),
                gender: $("#create_apply_gender").val(),
                email: $("#create_apply_email").val(),
                phone: $("#create_apply_phone").val(),
                address: $("#create_apply_address").val(),
                baptismType: $("#create_apply_baptismType").val(),
                marriageType: $("#create_apply_marriageType").val(),
                familyMembers: familyMembers,
                content: $("#create_apply_content").val()
            }),
            cache: false,
            success: (obj_data, status, xhr) => {
                alert("신청이 완료되었습니다.");
                // 이후 페이지 전환이나 초기화 등의 처리 가능
            },
            error: (obj_data, status, xhr) => {
                alert("에러가 발생했습니다.");
                console.error(obj_data);
            }
        });
    }
</script>
</body>
</html>
